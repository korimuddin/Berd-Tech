<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>File Encryption Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; padding: 40px; background: #f4f4f4; }
    .container { background: white; padding: 20px; border-radius: 10px; max-width: 600px; margin: auto; }
    .dropzone {
      border: 2px dashed #888; padding: 30px; text-align: center;
      border-radius: 10px; background: #fafafa; cursor: pointer;
    }
    .dropzone.dragover { border-color: #00aaff; background: #e8f8ff; }
    .field { margin-top: 15px; }
    button { padding: 10px 16px; border: none; background: #007bff; color: white; border-radius: 6px; cursor: pointer; }
    button:disabled { opacity: 0.5; }
    #download a { color: blue; }
  </style>
</head>
<body>
<div class="container">
  <h2>File Encryption Tool</h2>
  <p>Upload a file, choose an encryption method, and download the encrypted output.</p>

  <div id="dropzone" class="dropzone">
    <strong>Drag & drop a file here</strong><br>
    or click to select
    <input id="fileInput" type="file" style="display:none">
  </div>

  <div id="fileInfo"></div>

  <div class="field">
    <label>Encryption algorithm:</label><br>
    <select id="algorithm">
      <option value="AES-GCM-256">AES-GCM (256-bit)</option>
      <option value="AES-CBC-256">AES-CBC (256-bit)</option>
    </select>
  </div>

  <div class="field">
    <label>Password:</label><br>
    <input id="password" type="password">
  </div>

  <div class="field">
    <button id="encryptBtn">Encrypt File</button>
  </div>

  <p id="status"></p>
  <div id="download"></div>
</div>

<script>
const dropzone = document.getElementById('dropzone');
const fileInput = document.getElementById('fileInput');
const fileInfo = document.getElementById('fileInfo');
const algorithmSelect = document.getElementById('algorithm');
const passwordInput = document.getElementById('password');
const encryptBtn = document.getElementById('encryptBtn');
const statusEl = document.getElementById('status');
const downloadEl = document.getElementById('download');
let selectedFile = null;

dropzone.addEventListener('click', () => fileInput.click());
fileInput.addEventListener('change', e => setFile(e.target.files[0]));
dropzone.addEventListener('dragover', e => { e.preventDefault(); dropzone.classList.add('dragover'); });
dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
dropzone.addEventListener('drop', e => {
  e.preventDefault();
  dropzone.classList.remove('dragover');
  if (e.dataTransfer.files.length) setFile(e.dataTransfer.files[0]);
});

function setFile(file) {
  selectedFile = file;
  fileInfo.innerHTML = "<p><strong>Selected:</strong> " + file.name + " (" + (file.size/1024).toFixed(1) + " KB)</p>";
}

function getAlgorithmConfig(selection) {
  return selection === 'AES-CBC-256'
    ? { name: 'AES-CBC', keyLength: 256, ivLength: 16 }
    : { name: 'AES-GCM', keyLength: 256, ivLength: 12 };
}

async function deriveKey(password, salt, algoName, keyLength) {
  const pwKey = await crypto.subtle.importKey('raw', new TextEncoder().encode(password), {name:'PBKDF2'}, false, ['deriveKey']);
  return crypto.subtle.deriveKey(
    { name:'PBKDF2', salt, iterations:150000, hash:'SHA-256' },
    pwKey,
    { name:algoName, length:keyLength },
    false,
    ['encrypt']
  );
}

function randomBytes(n){ const a=new Uint8Array(n); crypto.getRandomValues(a); return a; }

encryptBtn.addEventListener('click', async () => {
  if (!selectedFile) return statusEl.textContent = "Please select a file.";
  if (!passwordInput.value) return statusEl.textContent = "Enter a password.";

  const algoConfig = getAlgorithmConfig(algorithmSelect.value);
  statusEl.textContent = "Encrypting...";
  encryptBtn.disabled = true;

  try {
    const data = await selectedFile.arrayBuffer();
    const salt = randomBytes(16);
    const iv = randomBytes(algoConfig.ivLength);
    const key = await deriveKey(passwordInput.value, salt, algoConfig.name, algoConfig.keyLength);
    const encrypted = await crypto.subtle.encrypt({name:algoConfig.name, iv}, key, data);

    const header = new Uint8Array([0x45,0x4E,0x43,0x31, algoConfig.name==='AES-GCM'?1:2, ...salt, ...iv]);
    const encBytes = new Uint8Array(encrypted);
    const combined = new Uint8Array(header.length + encBytes.length);
    combined.set(header, 0);
    combined.set(encBytes, header.length);

    const blob = new Blob([combined], {type:"application/octet-stream"});
    const url = URL.createObjectURL(blob);

    downloadEl.innerHTML = `<a download="${selectedFile.name}.enc" href="${url}">Download encrypted file</a>`;
    statusEl.textContent = "Encryption complete!";
  } catch (err) {
    statusEl.textContent = "Error: " + err;
  }
  encryptBtn.disabled = false;
});
</script>
</body>
</html>
